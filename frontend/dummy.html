
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTOISMS - Security Automation Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --border: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Top Navigation */
        .top-nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.9);
        }

        .nav-container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .snapshot-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--success);
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        /* Sidebar Toggle */
        .sidebar-toggle {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--text-primary);
            color: white;
            border: none;
            padding: 12px 6px;
            writing-mode: vertical-rl;
            cursor: pointer;
            z-index: 150;
            border-radius: 0 8px 8px 0;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: all 0.2s;
        }

        .sidebar-toggle:hover {
            padding-left: 10px;
            background: var(--primary);
        }

        /* Left Sidebar */
        .sidebar {
            position: fixed;
            left: -360px;
            top: 0;
            width: 360px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            z-index: 140;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
            padding-top: 64px;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .sidebar-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .guide-section {
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .guide-header:hover {
            background: #e2e8f0;
        }

        .guide-header h3 {
            font-size: 14px;
            font-weight: 700;
            margin: 0;
        }

        .guide-toggle-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            transition: transform 0.3s;
        }

        .guide-section.collapsed .guide-toggle-btn {
            transform: rotate(-90deg);
        }

        .guide-content {
            padding: 20px 24px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .guide-section.collapsed .guide-content {
            display: none;
        }

        .guide-content::-webkit-scrollbar {
            width: 6px;
        }

        .guide-content::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .guide-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .guide-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .guide-step {
            display: flex;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-primary);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .step-number {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .step-content h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .step-content p {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .terminal-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .horizontal-resizer {
            width: 100%;
            height: 6px;
            background: var(--border);
            cursor: row-resize;
            transition: background 0.2s;
        }

        .horizontal-resizer:hover {
            background: var(--primary);
        }

        .horizontal-resizer.dragging {
            background: var(--primary);
        }

        .terminal-header {
            padding: 12px 24px;
            background: #1e293b;
            color: white;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .log-badge {
            background: var(--danger);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .terminal-logs {
            flex: 1;
            background: #0f172a;
            padding: 16px;
            overflow-y: auto;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 4px;
            display: flex;
            gap: 8px;
        }

        .log-time {
            color: #64748b;
            flex-shrink: 0;
        }

        .log-entry.info { color: #3b82f6; }
        .log-entry.success { color: #10b981; }
        .log-entry.warning { color: #f59e0b; }
        .log-entry.error { color: #ef4444; }

        /* Resizer */
        .resizer {
            position: fixed;
            left: 360px;
            top: 64px;
            width: 4px;
            height: calc(100vh - 64px);
            cursor: col-resize;
            z-index: 130;
            transition: left 0.3s ease;
            opacity: 0;
        }

        .resizer:hover,
        .resizer.active {
            opacity: 1;
            background: var(--primary);
        }

        /* Main Content */
        .main-wrapper {
            transition: margin-left 0.3s ease;
            min-height: calc(100vh - 64px);
        }

        .main-wrapper.shifted {
            margin-left: 360px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Page Transitions */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e2e8f0;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }

        /* Setup Page */
        .setup-container {
            text-align: center;
            padding: 80px 40px;
        }

        .setup-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 40px;
        }

        .setup-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .setup-desc {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Stats Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .radar-chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .header-with-chart {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 1200px) {
            .header-with-chart {
                grid-template-columns: 1fr;
            }
        }

        /* Control Panel */
        .control-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: sticky;
            top: 80px;
            z-index: 50;
        }

        .control-row {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .search-box {
            flex: 1;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Table */
        .table-wrapper {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-primary);
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #e2e8f0;
        }

        th.sortable::after {
            content: 'â‡…';
            margin-left: 8px;
            opacity: 0.3;
        }

        th.sorted-asc::after {
            content: 'â†‘';
            opacity: 1;
        }

        th.sorted-desc::after {
            content: 'â†“';
            opacity: 1;
        }

        td {
            padding: 16px;
            font-size: 14px;
            border-bottom: 1px solid var(--border);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background: var(--bg-primary);
        }

        tr.hidden {
            display: none;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .code-badge {
            font-family: 'SF Mono', Monaco, monospace;
            background: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
        }

        /* Action Buttons in Table */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 4px;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
        }

        .action-btn.primary:hover {
            background: var(--primary-dark);
        }

        .action-btn.success {
            background: var(--success);
            color: white;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-secondary);
        }

        .close-btn:hover {
            color: var(--text-primary);
        }

        /* Progress Modal */
        .progress-content {
            text-align: center;
            padding: 40px;
        }

        .progress-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .progress-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .progress-desc {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-percent {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-links {
                display: none;
            }
            
            .page > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
            
            #chartContainer,
            #chartPlaceholder {
                margin-top: 16px;
                height: 350px !important;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn-group .btn {
                width: 100%;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Utility Classes */
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .gap-2 { gap: 8px; }
        .font-bold { font-weight: 700; }
        .text-sm { font-size: 13px; }
    </style>
</head>
<body>
    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        GUIDE
    </button>

    <!-- Left Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ</div>
            <div class="sidebar-subtitle">KISA ë³´ì•ˆ ì ê²€ ì ˆì°¨</div>
        </div>
        <div class="sidebar-content">
            <div class="guide-section" id="guideSection">
                <div class="guide-header" onclick="toggleGuide()">
                    <h3>ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ</h3>
                    <button class="guide-toggle-btn">â–¼</button>
                </div>
                <div class="guide-content">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Inventory íƒìƒ‰</h4>
                            <p>Ansible ì¸ë²¤í† ë¦¬ì—ì„œ íƒ€ê²Ÿ ì„œë²„ë¥¼ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>ì—°ê²° í™•ì¸</h4>
                            <p>íƒ€ê²Ÿ ì„œë²„ë“¤ì˜ SSH ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>ë³´ì•ˆ ì§„ë‹¨</h4>
                            <p>KISA ê°€ì´ë“œ ê¸°ë°˜ìœ¼ë¡œ ì·¨ì•½ì ì„ ìŠ¤ìº”í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>ì·¨ì•½ì  ì¡°ì¹˜</h4>
                            <p>ë°œê²¬ëœ ì·¨ì•½ì ì„ ìë™ìœ¼ë¡œ ì¡°ì¹˜í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>íšŒê·€ ê°ì§€</h4>
                            <p>ì™¸ë¶€ íŒ¨ì¹˜ë¡œ ì¸í•œ ë³´ì•ˆ íšŒê·€ë¥¼ ìë™ ê°ì§€í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <h4>ë³´ê³ ì„œ ìƒì„±</h4>
                            <p>ì§„ë‹¨ ë° ì¡°ì¹˜ ê²°ê³¼ë¥¼ PDF/Excelë¡œ ìƒì„±í•©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="horizontal-resizer" id="horizontalResizer"></div>
            
            <div class="terminal-section" id="terminalSection">
                <div class="terminal-header">
                    <span>ì‹œìŠ¤í…œ ë¡œê·¸</span>
                    <span class="log-badge" id="logCount">0</span>
                </div>
                <div class="terminal-logs" id="terminalLogs">
                    <div class="log-entry info">
                        <span class="log-time">[00:00:00]</span>
                        <span>System initialized</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resizer -->
    <div class="resizer" id="resizer"></div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="#" class="logo">
                    <div class="logo-icon">ğŸ”’</div>
                    <span>AUTOISMS</span>
                </a>
                <ul class="nav-links">
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#servers">Servers</a></li>
                    <li><a href="#reports">Reports</a></li>
                </ul>
            </div>
            <div class="nav-right">
                <div class="snapshot-badge" id="snapshotBadge">
                    <span>ğŸ“¸</span>
                    <span>Snapshot #0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-wrapper" id="mainWrapper">
        <div class="container">
            
            <!-- Initial Setup Page -->
            <div class="page active" id="initialPage">
                <div class="card">
                    <div class="setup-container">
                        <div class="setup-icon">ğŸ—‚ï¸</div>
                        <h1 class="setup-title">Ansible Inventory ë¶ˆëŸ¬ì˜¤ê¸°</h1>
                        <p class="setup-desc">
                            ë©”ì¸ ì„œë²„ì˜ Ansible ì„¤ì • íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ ê´€ë¦¬ ëŒ€ìƒ ì„œë²„ ëª©ë¡ì„ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤
                        </p>
                        <button class="btn btn-primary" onclick="loadInventory()">
                            <span>ğŸ“¡</span>
                            <span>Inventory í™•ì¸</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Target Server List Page -->
            <div class="page" id="targetListPage">
                <!-- Top Section: Stats + Radar Chart -->
                <div style="display: grid; grid-template-columns: 1fr 420px; gap: 24px; margin-bottom: 24px;">
                    
                    <!-- Left: Stats Dashboard -->
                    <div class="stats-grid" id="statsDashboard">
                        <div class="stat-card">
                            <div class="stat-value" id="totalServers" style="color: var(--primary)">0</div>
                            <div class="stat-label">ì „ì²´ ì„œë²„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="connectedServers" style="color: var(--success)">0</div>
                            <div class="stat-label">ì—°ê²°ë¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalVulns" style="color: var(--danger)">0</div>
                            <div class="stat-label">ì´ ì·¨ì•½ì </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="regressionServers" style="color: var(--warning)">0</div>
                            <div class="stat-label">íšŒê·€ ë°œìƒ</div>
                        </div>
                    </div>

                    <!-- Right: Radar Chart -->
                    <div>
                        <!-- Radar Chart Container -->
                        <div class="chart-container" id="chartContainer" style="display: none; height: 100%; padding: 20px;">
                            <div class="chart-title" style="text-align: center; margin-bottom: 16px;">ì¹´í…Œê³ ë¦¬ë³„ ì·¨ì•½ì  ë¶„í¬</div>
                            <div style="height: calc(100% - 50px); display: flex; align-items: center; justify-content: center;">
                                <canvas id="vulnChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Chart Placeholder -->
                        <div class="card" id="chartPlaceholder" style="text-align: center; padding: 40px 20px; height: 100%;">
                            <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.2;">ğŸ“Š</div>
                            <div style="color: var(--text-secondary); font-size: 13px; line-height: 1.8;">
                                ì§„ë‹¨ ì™„ë£Œ í›„<br>
                                ì¹´í…Œê³ ë¦¬ë³„ ì·¨ì•½ì <br>
                                ë¶„í¬ê°€ í‘œì‹œë©ë‹ˆë‹¤
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Server Management Card -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">íƒ€ê²Ÿ ì„œë²„ ê´€ë¦¬</h2>
                            <p class="card-subtitle">Ansible Inventoryì—ì„œ ë¶ˆëŸ¬ì˜¨ ì„œë²„ ëª©ë¡</p>
                        </div>
                    </div>

                    <!-- Control Panel -->
                    <div class="control-panel" style="position: static; top: auto;">
                        <div class="control-row">
                            <div class="search-box">
                                <input type="text" class="search-input" id="searchInput" placeholder="IP ì£¼ì†Œ ë˜ëŠ” í˜¸ìŠ¤íŠ¸ëª… ê²€ìƒ‰..." onkeyup="searchTargets()">
                                <span class="search-icon">ğŸ”</span>
                            </div>
                        </div>
                        <div class="control-row">
                            <div class="btn-group">
                                <button class="btn btn-secondary" id="diagnoseSelectedBtn" onclick="diagnoseSelected()" disabled>
                                    <span>ğŸ”</span>
                                    <span>ì„ íƒ ì§„ë‹¨</span>
                                </button>
                                <button class="btn btn-primary" id="diagnoseAllBtn" onclick="diagnoseAll()">
                                    <span>ğŸ”</span>
                                    <span>ì „ì²´ ì§„ë‹¨</span>
                                </button>
                                <button class="btn btn-success" id="fixAllTargetsBtn" onclick="fixAllTargets()" style="display: none;">
                                    <span>ğŸ”§</span>
                                    <span>ì „ì²´ ì¡°ì¹˜</span>
                                </button>
                                <button class="btn btn-warning" id="rediagnoseBtn" onclick="rediagnoseServers()" style="display: none; background: var(--warning); color: white;">
                                    <span>ğŸ”„</span>
                                    <span>ì¬ì§„ë‹¨</span>
                                </button>
                            </div>
                            <div class="btn-group" style="margin-left: 12px;">
                                <button class="btn btn-primary" id="diagnosisReportBtn" onclick="generateGlobalDiagnosisReport()" style="display: none;">
                                    <span>ğŸ“„</span>
                                    <span>ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ</span>
                                </button>
                                <button class="btn btn-success" id="remediationReportBtn" onclick="generateGlobalRemediationReport()" style="display: none;">
                                    <span>ğŸ“‹</span>
                                    <span>ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 50px;"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                    <th class="sortable" onclick="sortTable('ip')">ì„œë²„ IP</th>
                                    <th class="sortable" onclick="sortTable('hostname')">í˜¸ìŠ¤íŠ¸ëª…</th>
                                    <th class="sortable" onclick="sortTable('connected')">ì—°ê²°</th>
                                    <th class="sortable" onclick="sortTable('vulnCount')">ì·¨ì•½ì </th>
                                    <th class="sortable" onclick="sortTable('regression')">íšŒê·€</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="targetTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>

                        <div id="noResults" class="empty-state" style="display: none;">
                            <div class="empty-icon">ğŸ”</div>
                            <div class="empty-text">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTargetTitle">ì„œë²„ ìƒì„¸</h2>
                <button class="close-btn" onclick="closeDetailModal()">&times;</button>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortModalTable('code')">ì½”ë“œ</th>
                            <th class="sortable" onclick="sortModalTable('name')">ì·¨ì•½ì ëª…</th>
                            <th class="sortable" onclick="sortModalTable('category')">ì¹´í…Œê³ ë¦¬</th>
                            <th class="sortable" onclick="sortModalTable('severity')">ìœ„í—˜ë„</th>
                            <th class="sortable" onclick="sortModalTable('status')">ìƒíƒœ</th>
                            <th>ë¡œê·¸</th>
                            <th>ì¡°ì¹˜</th>
                        </tr>
                    </thead>
                    <tbody id="modalVulnTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeDetailModal()">ë‹«ê¸°</button>
                <button class="btn" style="background: #3b82f6; color: white;" onclick="generateServerDiagnosisReport(currentTargetIP)">
                    <span>ğŸ“„</span>
                    <span>ì§„ë‹¨ ë³´ê³ ì„œ</span>
                </button>
                <button class="btn btn-success" onclick="generateServerRemediationReport(currentTargetIP)">
                    <span>ğŸ“‹</span>
                    <span>ì¡°ì¹˜ ë³´ê³ ì„œ</span>
                </button>
                <button class="btn btn-primary" onclick="fixAllVulnerabilitiesInModal()">
                    <span>ğŸ”§</span>
                    <span>ì „ì²´ ì¡°ì¹˜</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal" id="progressModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="progress-content">
                <div class="progress-icon" id="progressIcon">â³</div>
                <h2 class="progress-title" id="progressTitle">ì§„í–‰ ì¤‘...</h2>
                <p class="progress-desc" id="progressDesc">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-percent">
                    <span id="progressPercent">0</span>%
                </div>
            </div>
        </div>
    </div>

    <script>
        let logCount = 0;
        let currentSnapshot = 0;
        let currentTargetIP = null;
        let currentSortColumn = null;
        let currentSortDirection = 'asc';
        let currentModalSortColumn = null;
        let currentModalSortDirection = 'asc';
        let chartInstance = null;
        let targetServers = [];

        const vulnerabilityTemplate = [
            { code: 'U-01', name: 'root ê³„ì • ì›ê²© ì ‘ì† ì œí•œ', severity: 'high', status: 'not-scanned', category: 'ê³„ì •ê´€ë¦¬', current_value: '', expected_value: 'SSH PermitRootLogin no ì„¤ì •', details: [] },
            { code: 'U-02', name: 'íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ë„ ì„¤ì •', severity: 'high', status: 'not-scanned', category: 'ê³„ì •ê´€ë¦¬', current_value: '', expected_value: 'ìµœì†Œ 8ì ì´ìƒ, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¡°í•©', details: [] },
            { code: 'U-44', name: 'root ì´ì™¸ UIDê°€ 0 ê¸ˆì§€', severity: 'medium', status: 'not-scanned', category: 'ê³„ì •ê´€ë¦¬', current_value: '', expected_value: 'root ê³„ì •ë§Œ UID 0 ë³´ìœ ', details: [] },
            { code: 'U-45', name: 'root ê³„ì • su ì œí•œ', severity: 'medium', status: 'not-scanned', category: 'ê³„ì •ê´€ë¦¬', current_value: '', expected_value: 'wheel ê·¸ë£¹ë§Œ su ì‚¬ìš© ê°€ëŠ¥', details: [] },
            { code: 'U-08', name: '/etc/shadow íŒŒì¼ ê¶Œí•œ ì„¤ì •', severity: 'high', status: 'not-scanned', category: 'íŒŒì¼ ë° ë””ë ‰í„°ë¦¬', current_value: '', expected_value: 'ê¶Œí•œ 000 ë˜ëŠ” 400', details: [] },
            { code: 'U-09', name: '/etc/passwd íŒŒì¼ ê¶Œí•œ ì„¤ì •', severity: 'medium', status: 'not-scanned', category: 'íŒŒì¼ ë° ë””ë ‰í„°ë¦¬', current_value: '', expected_value: 'ê¶Œí•œ 644 ì´í•˜', details: [] },
            { code: 'U-23', name: 'ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì œê±°', severity: 'medium', status: 'not-scanned', category: 'ì„œë¹„ìŠ¤ ê´€ë¦¬', current_value: '', expected_value: 'í•„ìˆ˜ ì„œë¹„ìŠ¤ë§Œ ì‹¤í–‰', details: [] },
            { code: 'U-24', name: 'NFS ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”', severity: 'medium', status: 'not-scanned', category: 'ì„œë¹„ìŠ¤ ê´€ë¦¬', current_value: '', expected_value: 'NFS ë¯¸ì‚¬ìš© ì‹œ ë¹„í™œì„±í™”', details: [] },
            { code: 'U-42', name: 'ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©', severity: 'high', status: 'not-scanned', category: 'íŒ¨ì¹˜ ê´€ë¦¬', current_value: '', expected_value: 'ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©ë¨', details: [] },
            { code: 'U-43', name: 'ë¡œê·¸ ê¸°ë¡ ë° ì •ê¸° ê²€í† ', severity: 'medium', status: 'not-scanned', category: 'ë¡œê·¸ ê´€ë¦¬', current_value: '', expected_value: 'ë¡œê·¸ ì •ê¸°ì ìœ¼ë¡œ ê²€í† ', details: [] },
        ];

        // ë¡œê·¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        function generateVulnDetails(code, hostname) {
            const timestamp = new Date().toISOString().slice(0, 19).replace('T', ' ');
            const details = [];
            
            switch(code) {
                case 'U-01':
                    details.push(`[${timestamp}] SSH ì„¤ì • íŒŒì¼ í™•ì¸ ì‹œì‘: /etc/ssh/sshd_config`);
                    details.push(`[${timestamp}] PermitRootLogin ì„¤ì • ê°’: yes (ì·¨ì•½)`);
                    details.push(`[${timestamp}] Telnet ì„œë¹„ìŠ¤ í™•ì¸: í™œì„±í™” ìƒíƒœ`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: root ì›ê²© ë¡œê·¸ì¸ í—ˆìš©ë¨`);
                    break;
                case 'U-02':
                    details.push(`[${timestamp}] íŒ¨ìŠ¤ì›Œë“œ ì •ì±… íŒŒì¼ í™•ì¸: /etc/security/pwquality.conf`);
                    details.push(`[${timestamp}] minlen = 6 (ê¸°ì¤€: 8 ì´ìƒ)`);
                    details.push(`[${timestamp}] dcredit, ucredit, ocredit ë¯¸ì„¤ì •`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ë„ ì •ì±… ë¯¸í¡`);
                    break;
                case 'U-44':
                    details.push(`[${timestamp}] /etc/passwd íŒŒì¼ ë¶„ì„ ì‹œì‘`);
                    details.push(`[${timestamp}] UID 0ì¸ ê³„ì • í™•ì¸: root, admin`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: root ì™¸ 'admin' ê³„ì •ì´ UID 0 ì‚¬ìš© ì¤‘`);
                    break;
                case 'U-45':
                    details.push(`[${timestamp}] /etc/pam.d/su íŒŒì¼ í™•ì¸`);
                    details.push(`[${timestamp}] pam_wheel.so ì„¤ì • ì—†ìŒ`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: ëª¨ë“  ì‚¬ìš©ìê°€ su ëª…ë ¹ ì‚¬ìš© ê°€ëŠ¥`);
                    break;
                case 'U-08':
                    details.push(`[${timestamp}] /etc/shadow íŒŒì¼ ê¶Œí•œ í™•ì¸`);
                    details.push(`[${timestamp}] í˜„ì¬ ê¶Œí•œ: 644 (rw-r--r--)`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: shadow íŒŒì¼ì´ ì¼ë°˜ ì‚¬ìš©ìë„ ì½ê¸° ê°€ëŠ¥`);
                    break;
                case 'U-09':
                    details.push(`[${timestamp}] /etc/passwd íŒŒì¼ ê¶Œí•œ í™•ì¸`);
                    details.push(`[${timestamp}] í˜„ì¬ ê¶Œí•œ: 666 (rw-rw-rw-)`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: passwd íŒŒì¼ì´ ëª¨ë“  ì‚¬ìš©ìê°€ ì“°ê¸° ê°€ëŠ¥`);
                    break;
                case 'U-23':
                    details.push(`[${timestamp}] ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸: systemctl list-units --type=service`);
                    details.push(`[${timestamp}] ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ë°œê²¬: telnet, rlogin, rexec`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: ë³´ì•ˆ ìœ„í—˜ì´ ë†’ì€ ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘`);
                    break;
                case 'U-24':
                    details.push(`[${timestamp}] NFS ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸`);
                    details.push(`[${timestamp}] nfs-server.service: active (running)`);
                    details.push(`[${timestamp}] /etc/exports ì„¤ì • í™•ì¸: ê³µìœ  ì„¤ì • ì¡´ì¬`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” NFS ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘`);
                    break;
                case 'U-42':
                    details.push(`[${timestamp}] ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ í™•ì¸`);
                    details.push(`[${timestamp}] yum check-update ì‹¤í–‰`);
                    details.push(`[${timestamp}] ë³´ì•ˆ ì—…ë°ì´íŠ¸ ê°€ëŠ¥ íŒ¨í‚¤ì§€: 15ê°œ ë°œê²¬`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: ì¤‘ìš” ë³´ì•ˆ íŒ¨ì¹˜ ë¯¸ì ìš©`);
                    break;
                case 'U-43':
                    details.push(`[${timestamp}] ë¡œê·¸ ì„¤ì • íŒŒì¼ í™•ì¸: /etc/rsyslog.conf`);
                    details.push(`[${timestamp}] ë¡œê·¸ íŒŒì¼ ë³´ê´€ ê¸°ê°„ í™•ì¸: ì„¤ì • ì—†ìŒ`);
                    details.push(`[${timestamp}] ë¡œê·¸ ì •ê¸° ê²€í†  ìŠ¤í¬ë¦½íŠ¸: ì—†ìŒ`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬: ë¡œê·¸ ê´€ë¦¬ ì •ì±… ë¯¸í¡`);
                    break;
                default:
                    details.push(`[${timestamp}] ì ê²€ ì‹œì‘: ${code}`);
                    details.push(`[${timestamp}] ì·¨ì•½ì  ë°œê²¬`);
            }
            
            return details;
        }

        function generateCurrentValue(code) {
            switch(code) {
                case 'U-01': return 'SSH PermitRootLogin yes, Telnet í™œì„±í™”';
                case 'U-02': return 'minlen=6, ë³µì¡ë„ ì •ì±… ë¯¸ì„¤ì •';
                case 'U-44': return 'root, admin ê³„ì •ì´ UID 0 ì‚¬ìš©';
                case 'U-45': return 'pam_wheel.so ë¯¸ì„¤ì •';
                case 'U-08': return 'ê¶Œí•œ 644 (rw-r--r--)';
                case 'U-09': return 'ê¶Œí•œ 666 (rw-rw-rw-)';
                case 'U-23': return 'telnet, rlogin, rexec ì‹¤í–‰ ì¤‘';
                case 'U-24': return 'NFS ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘';
                case 'U-42': return '15ê°œ ë³´ì•ˆ ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘';
                case 'U-43': return 'ë¡œê·¸ ê´€ë¦¬ ì •ì±… ë¯¸ì„¤ì •';
                default: return 'ì·¨ì•½';
            }
        }

        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const toggleBtn = document.getElementById('sidebarToggle');
            const resizer = document.getElementById('resizer');
            
            const isActive = sidebar.classList.contains('active');
            const sidebarWidth = sidebar.offsetWidth;
            
            sidebar.classList.toggle('active');
            mainWrapper.classList.toggle('shifted');
            resizer.classList.toggle('active');
            
            if (!isActive) {
                toggleBtn.style.left = sidebarWidth + 'px';
                mainWrapper.style.marginLeft = sidebarWidth + 'px';
                resizer.style.left = sidebarWidth + 'px';
            } else {
                toggleBtn.style.left = '0px';
                mainWrapper.style.marginLeft = '0px';
            }
        }

        // Guide Toggle
        function toggleGuide() {
            const guideSection = document.getElementById('guideSection');
            guideSection.classList.toggle('collapsed');
        }

        // Horizontal Resizer
        let isHorizontalResizing = false;
        let startY = 0;
        let startGuideHeight = 0;

        document.getElementById('horizontalResizer').addEventListener('mousedown', (e) => {
            isHorizontalResizing = true;
            startY = e.clientY;
            const guideContent = document.querySelector('.guide-content');
            startGuideHeight = guideContent.offsetHeight;
            document.getElementById('horizontalResizer').classList.add('dragging');
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isHorizontalResizing) return;
            
            const diff = e.clientY - startY;
            const newHeight = Math.max(100, Math.min(600, startGuideHeight + diff));
            
            const guideContent = document.querySelector('.guide-content');
            guideContent.style.maxHeight = newHeight + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (isHorizontalResizing) {
                isHorizontalResizing = false;
                document.getElementById('horizontalResizer').classList.remove('dragging');
            }
        });

        // Terminal Logs
        function addLog(message, type = 'info') {
            logCount++;
            document.getElementById('logCount').textContent = logCount;
            
            const logsContainer = document.getElementById('terminalLogs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const now = new Date();
            const time = now.toTimeString().split(' ')[0];
            
            logEntry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span>${message}</span>
            `;
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // Update Stats
        function updateStats() {
            const total = targetServers.length;
            const connected = targetServers.filter(s => s.connected).length;
            const totalVulns = targetServers.reduce((sum, s) => sum + s.vulnCount, 0);
            const regression = targetServers.filter(s => s.hasRegression).length;

            document.getElementById('totalServers').textContent = total;
            document.getElementById('connectedServers').textContent = connected;
            document.getElementById('totalVulns').textContent = totalVulns;
            document.getElementById('regressionServers').textContent = regression;

            if (targetServers.some(s => s.diagnosed)) {
                updateChart();
            }
        }

        // Update Chart (Radar Chart for KISA Categories)
        function updateChart() {
            const container = document.getElementById('chartContainer');
            const placeholder = document.getElementById('chartPlaceholder');
            
            container.style.display = 'block';
            placeholder.style.display = 'none';

            // ì¹´í…Œê³ ë¦¬ë³„ ì·¨ì•½ì  ì§‘ê³„
            const categoryCount = {};
            
            targetServers.forEach(server => {
                if (server.diagnosed) {
                    server.vulnerabilities.forEach(vuln => {
                        if (vuln.status === 'vulnerable') {
                            if (!categoryCount[vuln.category]) {
                                categoryCount[vuln.category] = 0;
                            }
                            categoryCount[vuln.category]++;
                        }
                    });
                }
            });

            const categories = Object.keys(categoryCount);
            const counts = Object.values(categoryCount);

            const ctx = document.getElementById('vulnChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'ì·¨ì•½ì  ê°œìˆ˜',
                        data: counts,
                        backgroundColor: 'rgba(37, 99, 235, 0.15)',
                        borderColor: '#2563eb',
                        borderWidth: 2,
                        pointBackgroundColor: '#2563eb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointHoverBackgroundColor: '#1e40af',
                        pointHoverBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                display: false, // ì¤‘ì•™ ëˆˆê¸ˆ ìˆ«ì ìˆ¨ê¹€
                                backdropColor: 'transparent'
                            },
                            pointLabels: {
                                font: {
                                    size: 12,
                                    weight: '600'
                                },
                                color: '#1e293b',
                                padding: 15,
                                callback: function(label, index) {
                                    // ì¹´í…Œê³ ë¦¬ëª…(ê°œìˆ˜) í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
                                    return label + '(' + counts[index] + ')';
                                }
                            },
                            grid: {
                                color: '#e2e8f0',
                                lineWidth: 1
                            },
                            angleLines: {
                                color: '#e2e8f0',
                                lineWidth: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.r + 'ê°œ';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Search Targets
        function searchTargets() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#targetTableBody tr');
            let visibleCount = 0;

            rows.forEach(row => {
                const ip = row.cells[1]?.textContent.toLowerCase() || '';
                const hostname = row.cells[2]?.textContent.toLowerCase() || '';
                
                if (ip.includes(searchTerm) || hostname.includes(searchTerm)) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });

            document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        }

        // Sort Table
        function sortTable(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            document.querySelectorAll('.table-wrapper th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });
            
            const headerMap = {
                'ip': 1, 'hostname': 2, 'connected': 3, 'vulnCount': 4, 'regression': 5
            };
            
            const th = document.querySelectorAll('.table-wrapper th')[headerMap[column]];
            th.classList.add(currentSortDirection === 'asc' ? 'sorted-asc' : 'sorted-desc');

            targetServers.sort((a, b) => {
                let aVal, bVal;

                switch(column) {
                    case 'ip':
                        aVal = a.ip.split('.').map(n => parseInt(n).toString().padStart(3, '0')).join('');
                        bVal = b.ip.split('.').map(n => parseInt(n).toString().padStart(3, '0')).join('');
                        break;
                    case 'hostname':
                        aVal = a.hostname.toLowerCase();
                        bVal = b.hostname.toLowerCase();
                        break;
                    case 'connected':
                        aVal = a.connected ? 1 : 0;
                        bVal = b.connected ? 1 : 0;
                        break;
                    case 'vulnCount':
                        aVal = a.vulnCount;
                        bVal = b.vulnCount;
                        break;
                    case 'regression':
                        aVal = a.hasRegression ? 1 : 0;
                        bVal = b.hasRegression ? 1 : 0;
                        break;
                    default:
                        return 0;
                }

                if (aVal < bVal) return currentSortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            renderTargetTable();
            addLog(`${column} ì»¬ëŸ¼ ${currentSortDirection === 'asc' ? 'ì˜¤ë¦„ì°¨ìˆœ' : 'ë‚´ë¦¼ì°¨ìˆœ'} ì •ë ¬`, 'info');
        }

        // Load Inventory
        function loadInventory() {
            addLog('Ansible Inventory íƒìƒ‰ ì‹œì‘', 'info');
            showProgress('ğŸ—‚ï¸', 'Inventory í™•ì¸ ì¤‘', 'Ansible ì„¤ì • íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                targetServers = [
                    { ip: '192.168.1.10', hostname: 'web-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.1.20', hostname: 'db-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.1.30', hostname: 'api-server-01', connected: false, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.1.40', hostname: 'app-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.1.50', hostname: 'cache-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.2.10', hostname: 'web-server-02', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.2.20', hostname: 'db-server-02', connected: false, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.2.30', hostname: 'api-server-02', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.2.40', hostname: 'app-server-02', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.3.10', hostname: 'file-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.3.20', hostname: 'monitoring-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.3.30', hostname: 'backup-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.4.10', hostname: 'load-balancer-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.4.20', hostname: 'proxy-server-01', connected: false, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                    { ip: '192.168.4.30', hostname: 'mail-server-01', connected: true, vulnerabilities: JSON.parse(JSON.stringify(vulnerabilityTemplate)), vulnCount: 0, diagnosed: false, hasRegression: false },
                ];
                
                renderTargetTable();
                updateStats();
                closeProgress();
                
                document.getElementById('initialPage').classList.remove('active');
                document.getElementById('targetListPage').classList.add('active');
                
                addLog(`${targetServers.length}ê°œ íƒ€ê²Ÿ ì„œë²„ ë°œê²¬`, 'success');
            }, 2000);
        }

        // Render Target Table
        function renderTargetTable() {
            const tbody = document.getElementById('targetTableBody');
            tbody.innerHTML = '';
            
            targetServers.forEach((server, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="target-checkbox" data-index="${index}" onchange="updateSelectButtons()"></td>
                    <td><span class="code-badge">${server.ip}</span></td>
                    <td>${server.hostname}</td>
                    <td>
                        ${server.connected ? 
                            '<span class="badge success">ì—°ê²°ë¨</span>' : 
                            '<span class="badge danger">ëŠê¹€</span>'
                        }
                    </td>
                    <td>${server.diagnosed ? server.vulnCount : '-'}</td>
                    <td>${server.hasRegression ? '<span class="badge warning">íšŒê·€</span>' : '-'}</td>
                    <td>
                        <button class="action-btn primary" onclick="showDetail('${server.ip}')" ${!server.diagnosed ? 'disabled' : ''}>ìƒì„¸</button>
                        <button class="action-btn" style="background: #3b82f6; color: white;" onclick="generateServerDiagnosisReport('${server.ip}')" ${!server.diagnosed ? 'disabled' : ''}>ì§„ë‹¨ ë³´ê³ ì„œ</button>
                        <button class="action-btn" style="background: #22c55e; color: white;" onclick="generateServerRemediationReport('${server.ip}')" ${!server.diagnosed ? 'disabled' : ''}>ì¡°ì¹˜ ë³´ê³ ì„œ</button>
                        <button class="action-btn success" onclick="fixServer('${server.ip}')" ${!server.diagnosed || !server.connected || !server.server_id || !server.analysis_id || !server.vulnCount ? 'disabled' : ''}>${server.hostname || server.ip} ì¡°ì¹˜</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Toggle Select All
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.target-checkbox');
            
            checkboxes.forEach(cb => {
                const index = parseInt(cb.dataset.index);
                if (targetServers[index].connected) {
                    cb.checked = selectAll.checked;
                }
            });
            
            updateSelectButtons();
        }

        // Update Select Buttons
        function updateSelectButtons() {
            const checkboxes = document.querySelectorAll('.target-checkbox:checked');
            document.getElementById('diagnoseSelectedBtn').disabled = checkboxes.length === 0;
        }

        // Diagnose Selected
        function diagnoseSelected() {
            const checkboxes = document.querySelectorAll('.target-checkbox:checked');
            const selectedIndices = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
            
            if (selectedIndices.length === 0) return;
            
            addLog(`${selectedIndices.length}ê°œ ì„œë²„ ì§„ë‹¨ ì‹œì‘`, 'info');
            showProgress('ğŸ”', 'ì·¨ì•½ì  ìŠ¤ìº” ì¤‘', 'ì„ íƒëœ ì„œë²„ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                selectedIndices.forEach(index => {
                    const server = targetServers[index];
                    server.vulnerabilities.forEach(v => {
                        v.status = 'vulnerable';
                        v.current_value = generateCurrentValue(v.code);
                        v.details = generateVulnDetails(v.code, server.hostname);
                    });
                    server.vulnCount = server.vulnerabilities.length;
                    server.diagnosed = true;
                    addLog(`${server.ip}: ${server.vulnCount}ê°œ ì·¨ì•½ì  ë°œê²¬`, 'warning');
                });
                
                renderTargetTable();
                updateStats();
                closeProgress();
                
                currentSnapshot = 1;
                updateSnapshotBadge();
                
                document.getElementById('fixAllTargetsBtn').style.display = 'inline-flex';
                document.getElementById('diagnosisReportBtn').style.display = 'inline-flex';
                
                addLog('ì§„ë‹¨ ì™„ë£Œ', 'success');
            }, 3000);
        }

        // Diagnose All
        function diagnoseAll() {
            const connectedServers = targetServers.filter(s => s.connected);
            addLog(`${connectedServers.length}ê°œ ì„œë²„ ì „ì²´ ì§„ë‹¨ ì‹œì‘`, 'info');
            showProgress('ğŸ”', 'ì „ì²´ ìŠ¤ìº” ì¤‘', 'ëª¨ë“  ì„œë²„ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                connectedServers.forEach(server => {
                    server.vulnerabilities.forEach(v => {
                        v.status = 'vulnerable';
                        v.current_value = generateCurrentValue(v.code);
                        v.details = generateVulnDetails(v.code, server.hostname);
                    });
                    server.vulnCount = server.vulnerabilities.length;
                    server.diagnosed = true;
                    addLog(`${server.ip}: ${server.vulnCount}ê°œ ì·¨ì•½ì  ë°œê²¬`, 'warning');
                });
                
                renderTargetTable();
                updateStats();
                closeProgress();
                
                currentSnapshot = 1;
                updateSnapshotBadge();
                
                document.getElementById('fixAllTargetsBtn').style.display = 'inline-flex';
                document.getElementById('diagnosisReportBtn').style.display = 'inline-flex';
                
                addLog('ì „ì²´ ì§„ë‹¨ ì™„ë£Œ', 'success');
            }, 3000);
        }

        // ê°œë³„ ì„œë²„ ì¡°ì¹˜ (í…Œì´ë¸” í–‰ì˜ "XXX ì¡°ì¹˜" ë²„íŠ¼)
        function fixServer(ip) {
            const server = targetServers.find(s => s.ip === ip);
            if (!server || !server.diagnosed) return;
            const vulnCount = (server.vulnerabilities || []).filter(v => (v.status || '').toLowerCase() === 'vulnerable').length;
            if (vulnCount === 0) { alert('ì¡°ì¹˜í•  ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
            if (!confirm(`"${server.hostname}" (${server.ip}) ì„œë²„ì˜ ì·¨ì•½ì  ${vulnCount}ê°œë¥¼ ëª¨ë‘ ì¡°ì¹˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            addLog(`${server.ip}: ì „ì²´ ì¡°ì¹˜ ì‹œì‘`, 'info');
            showProgress('ğŸ”§', 'ì¼ê´„ ì¡°ì¹˜ ì¤‘', server.hostname + ' ì„œë²„ ì·¨ì•½ì  ì¡°ì¹˜ ì¤‘');
            setTimeout(() => {
                (server.vulnerabilities || []).forEach(v => {
                    if ((v.status || '').toLowerCase() === 'vulnerable') {
                        v.status = 'fixed';
                        v.current_value = v.expected_value;
                    }
                });
                server.vulnCount = 0;
                renderTargetTable();
                updateStats();
                closeProgress();
                addLog(`${server.ip}: ì „ì²´ ì¡°ì¹˜ ì™„ë£Œ`, 'success');
            }, 3000);
        }

        // Fix All Targets
        function fixAllTargets() {
            const diagnosedServers = targetServers.filter(s => s.diagnosed && s.vulnCount > 0);
            
            if (diagnosedServers.length === 0) {
                alert('ì¡°ì¹˜í•  ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`${diagnosedServers.length}ê°œ ì„œë²„ì˜ ëª¨ë“  ì·¨ì•½ì ì„ ì¡°ì¹˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            addLog('ì „ì²´ ì„œë²„ ì¼ê´„ ì¡°ì¹˜ ì‹œì‘', 'info');
            showProgress('ğŸ”§', 'ì¼ê´„ ì¡°ì¹˜ ì¤‘', 'ëª¨ë“  ì·¨ì•½ì ì„ í•´ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                const timestamp = new Date().toISOString().slice(0, 19).replace('T', ' ');
                diagnosedServers.forEach(server => {
                    server.vulnerabilities.forEach(v => {
                        if (v.status === 'vulnerable') {
                            v.status = 'fixed';
                            // ì¡°ì¹˜ í›„ ë¡œê·¸ ì—…ë°ì´íŠ¸
                            v.current_value = v.expected_value;
                            v.details.push(`[${timestamp}] ì¡°ì¹˜ ì™„ë£Œ: ì„¤ì • ë³€ê²½ ì ìš©ë¨`);
                            v.details.push(`[${timestamp}] ìµœì¢… ìƒíƒœ: ${v.expected_value}`);
                        }
                    });
                    server.vulnCount = 0;
                    addLog(`${server.ip}: ì „ì²´ ì¡°ì¹˜ ì™„ë£Œ`, 'success');
                });
                
                renderTargetTable();
                updateStats();
                closeProgress();
                
                currentSnapshot = 2;
                updateSnapshotBadge();
                
                // ì „ì²´ ì¡°ì¹˜ ì™„ë£Œ í›„ ì¬ì§„ë‹¨ ë²„íŠ¼ê³¼ ì¡°ì¹˜ ë³´ê³ ì„œ ë²„íŠ¼ í‘œì‹œ
                document.getElementById('rediagnoseBtn').style.display = 'inline-flex';
                document.getElementById('remediationReportBtn').style.display = 'inline-flex';
                
                addLog('ì „ì²´ ì¡°ì¹˜ ì™„ë£Œ', 'success');
                addLog('ì™¸ë¶€ì—ì„œ íŒ¨ì¹˜ ì‘ì—… í›„ "ì¬ì§„ë‹¨" ë²„íŠ¼ìœ¼ë¡œ íšŒê·€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”', 'info');
            }, 5000);
        }

        // Rediagnose Servers (íšŒê·€ í™•ì¸)
        function rediagnoseServers() {
            if (!confirm('ì„œë²„ ìƒíƒœë¥¼ ì¬ì§„ë‹¨í•˜ì—¬ íšŒê·€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            addLog('ì¬ì§„ë‹¨ ì‹œì‘ - ì™¸ë¶€ íŒ¨ì¹˜ ì´í›„ ë³€ê²½ì‚¬í•­ í™•ì¸ ì¤‘', 'info');
            showProgress('ğŸ”¬', 'íšŒê·€ ë¶„ì„ ì¤‘', 'ì´ì „ ìŠ¤ëƒ…ìƒ·ê³¼ í˜„ì¬ ìƒíƒœë¥¼ ë¹„êµí•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ì— ë‹¤ì‹œ ì ‘ì†í•˜ì—¬ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸
                // ì‹œë®¬ë ˆì´ì…˜: ì¼ë¶€ ì„œë²„ì—ì„œ ì™¸ë¶€ íŒ¨ì¹˜ë¡œ ì¸í•œ íšŒê·€ ë°œìƒ
                const connectedServers = targetServers.filter(s => s.connected && s.diagnosed);
                
                // ëœë¤í•˜ê²Œ 30% ì •ë„ì˜ ì„œë²„ì—ì„œ íšŒê·€ ë°œìƒ
                const regressionCount = Math.floor(connectedServers.length * 0.3);
                const regressionIndices = [];
                
                while (regressionIndices.length < regressionCount) {
                    const randomIndex = Math.floor(Math.random() * connectedServers.length);
                    if (!regressionIndices.includes(randomIndex)) {
                        regressionIndices.push(randomIndex);
                    }
                }
                
                let totalRegressions = 0;
                
                regressionIndices.forEach(idx => {
                    const server = connectedServers[idx];
                    const regressionVulnCount = Math.floor(Math.random() * 2) + 1; // 1-2ê°œ ì·¨ì•½ì 
                    
                    // ì¼ë¶€ ì·¨ì•½ì ì„ ë‹¤ì‹œ ì·¨ì•½ ìƒíƒœë¡œ ë³€ê²½
                    for (let i = 0; i < regressionVulnCount && i < server.vulnerabilities.length; i++) {
                        if (server.vulnerabilities[i].status === 'fixed') {
                            server.vulnerabilities[i].status = 'vulnerable';
                            // íšŒê·€ ë°œìƒ ì‹œ ë¡œê·¸ ë°ì´í„° ì¬ìƒì„±
                            server.vulnerabilities[i].current_value = generateCurrentValue(server.vulnerabilities[i].code);
                            server.vulnerabilities[i].details = generateVulnDetails(server.vulnerabilities[i].code, server.hostname);
                            totalRegressions++;
                        }
                    }
                    
                    server.vulnCount = server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                    server.hasRegression = server.vulnCount > 0;
                    
                    if (server.hasRegression) {
                        addLog(`${server.ip}: ${server.vulnCount}ê°œ íšŒê·€ ë°œê²¬ - ì™¸ë¶€ íŒ¨ì¹˜ë¡œ ì¸í•œ ì„¤ì • ë³€ê²½ ê°ì§€`, 'error');
                    }
                });
                
                // íšŒê·€ê°€ ì—†ëŠ” ì„œë²„ë„ ë¡œê·¸ì— í‘œì‹œ
                connectedServers.forEach(server => {
                    if (!server.hasRegression) {
                        addLog(`${server.ip}: ì •ìƒ - íšŒê·€ ì—†ìŒ`, 'success');
                    }
                });
                
                renderTargetTable();
                updateStats();
                closeProgress();
                
                currentSnapshot = 3;
                updateSnapshotBadge();
                
                if (totalRegressions > 0) {
                    addLog('='.repeat(50), 'warning');
                    addLog(`ì¬ì§„ë‹¨ ì™„ë£Œ: ${regressionIndices.length}ê°œ ì„œë²„ì—ì„œ ì´ ${totalRegressions}ê°œ íšŒê·€ ë°œê²¬`, 'error');
                    addLog('ì™¸ë¶€ íŒ¨ì¹˜ë¡œ ì¸í•´ ë³´ì•ˆ ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤', 'error');
                    addLog('íšŒê·€ê°€ ë°œìƒí•œ ì„œë²„ë“¤ì„ ë‹¤ì‹œ ì¡°ì¹˜í•˜ì„¸ìš”', 'warning');
                    addLog('='.repeat(50), 'warning');
                    
                    alert(`âš ï¸ íšŒê·€ ê°ì§€!\n\n${regressionIndices.length}ê°œ ì„œë²„ì—ì„œ ì´ ${totalRegressions}ê°œì˜ íšŒê·€ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì™¸ë¶€ íŒ¨ì¹˜ë¡œ ì¸í•´ ì´ì „ì— ì¡°ì¹˜í•œ ë³´ì•ˆ ì„¤ì •ì´ ë‹¤ì‹œ ì·¨ì•½ ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nìƒì„¸ ë‚´ìš©ì€ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                } else {
                    addLog('='.repeat(50), 'success');
                    addLog('ì¬ì§„ë‹¨ ì™„ë£Œ: ëª¨ë“  ì„œë²„ ì •ìƒ - íšŒê·€ ì—†ìŒ', 'success');
                    addLog('='.repeat(50), 'success');
                    
                    alert('âœ… ëª¨ë“  ì„œë²„ ì •ìƒ\n\níšŒê·€ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\në³´ì•ˆ ì„¤ì •ì´ ì •ìƒì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.');
                }
            }, 3000);
        }

        // Show Detail Modal
        function showDetail(ip) {
            const server = targetServers.find(s => s.ip === ip);
            if (!server) return;
            
            currentTargetIP = ip;
            currentModalSortColumn = 'code'; // ê¸°ë³¸ ì½”ë“œìˆœ ì •ë ¬
            currentModalSortDirection = 'asc';
            
            document.getElementById('modalTargetTitle').textContent = `${server.hostname} (${server.ip})`;
            
            renderModalTable();
            
            document.getElementById('detailModal').classList.add('active');
        }

        // Render Modal Table
        function renderModalTable() {
            const server = targetServers.find(s => s.ip === currentTargetIP);
            if (!server) return;
            
            const tbody = document.getElementById('modalVulnTableBody');
            tbody.innerHTML = '';
            
            // ì·¨ì•½ì  ë°°ì—´ ë³µì‚¬ í›„ ì •ë ¬
            const sortedVulnerabilities = [...server.vulnerabilities].sort((a, b) => {
                let aVal, bVal;
                
                switch(currentModalSortColumn) {
                    case 'code':
                        // U-01, U-02 í˜•ì‹ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì •ë ¬
                        aVal = parseInt(a.code.replace('U-', ''));
                        bVal = parseInt(b.code.replace('U-', ''));
                        break;
                    case 'name':
                        aVal = a.name.toLowerCase();
                        bVal = b.name.toLowerCase();
                        break;
                    case 'category':
                        aVal = a.category.toLowerCase();
                        bVal = b.category.toLowerCase();
                        break;
                    case 'severity':
                        const severityOrder = { 'high': 2, 'medium': 1, 'low': 0 };
                        aVal = severityOrder[a.severity] || 0;
                        bVal = severityOrder[b.severity] || 0;
                        break;
                    case 'status':
                        const statusOrder = { 'vulnerable': 2, 'not-scanned': 1, 'fixed': 0 };
                        aVal = statusOrder[a.status] || 0;
                        bVal = statusOrder[b.status] || 0;
                        break;
                    default:
                        return 0;
                }
                
                if (aVal < bVal) return currentModalSortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentModalSortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            sortedVulnerabilities.forEach((vuln, index) => {
                // ì·¨ì•½ì  í–‰
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="code-badge">${vuln.code}</span></td>
                    <td>${vuln.name}</td>
                    <td><span class="badge" style="background: #dbeafe; color: #1e40af;">${vuln.category}</span></td>
                    <td><span class="badge ${vuln.severity === 'high' ? 'danger' : 'warning'}">${vuln.severity === 'high' ? 'ë†’ìŒ' : 'ì¤‘ê°„'}</span></td>
                    <td><span class="badge ${vuln.status === 'vulnerable' ? 'danger' : 'success'}">${vuln.status === 'vulnerable' ? 'ì·¨ì•½' : 'ì •ìƒ'}</span></td>
                    <td>
                        <button class="action-btn" style="background: #6366f1; color: white; padding: 4px 10px; font-size: 12px;" onclick="toggleVulnDetail(${index})">
                            ìƒì„¸ ë¡œê·¸
                        </button>
                    </td>
                    <td>
                        <button class="action-btn primary" ${vuln.status === 'fixed' ? 'disabled' : ''} onclick="fixVulnerabilityInModal('${vuln.code}')">
                            ${vuln.status === 'fixed' ? 'ì¡°ì¹˜ì™„ë£Œ' : 'ì¡°ì¹˜í•˜ê¸°'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
                
                // ë¡œê·¸ ìƒì„¸ í–‰ (ìˆ¨ê¹€ ìƒíƒœë¡œ ì‹œì‘)
                const detailRow = document.createElement('tr');
                detailRow.id = `vuln-detail-${index}`;
                detailRow.style.display = 'none';
                detailRow.innerHTML = `
                    <td colspan="7" style="padding: 0; background: var(--bg-primary);">
                        <div style="padding: 20px; border-top: 2px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 style="font-size: 16px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: 8px; margin: 0;">
                                    <span style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 6px; font-size: 14px;">${vuln.code}</span>
                                    <span>${vuln.name}</span>
                                </h3>
                                <button class="btn btn-secondary" style="padding: 6px 14px; font-size: 13px;" onclick="toggleVulnDetail(${index})">ë‹«ê¸°</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                                <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid var(--danger);">
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">í˜„ì¬ ìƒíƒœ</div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--danger);">${vuln.current_value || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                </div>
                                <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid var(--success);">
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">ê¶Œì¥ ì„¤ì •</div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--success);">${vuln.expected_value || 'ê¶Œì¥ ì„¤ì • ì—†ìŒ'}</div>
                                </div>
                            </div>

                            <div style="background: #0f172a; border-radius: 8px; padding: 16px; max-height: 300px; overflow-y: auto;">
                                <div style="color: #94a3b8; font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 13px; line-height: 1.7;">
                                    ${generateLogHTML(vuln.details)}
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(detailRow);
            });
        }

        // Sort Modal Table
        function sortModalTable(column) {
            if (currentModalSortColumn === column) {
                currentModalSortDirection = currentModalSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentModalSortColumn = column;
                currentModalSortDirection = 'asc';
            }
            
            renderModalTable();
            addLog(`ìƒì„¸ í…Œì´ë¸”: ${column} ì»¬ëŸ¼ ${currentModalSortDirection === 'asc' ? 'ì˜¤ë¦„ì°¨ìˆœ' : 'ë‚´ë¦¼ì°¨ìˆœ'} ì •ë ¬`, 'info');
        }

        // ë¡œê·¸ HTML ìƒì„±
        function generateLogHTML(details) {
            if (!details || details.length === 0) {
                return '<div style="color: #64748b;">ë¡œê·¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
            
            return details.map(log => {
                let color = '#94a3b8';
                if (log.includes('ì·¨ì•½ì  ë°œê²¬') || log.includes('ì·¨ì•½')) {
                    color = '#fca5a5';
                } else if (log.includes('í™•ì¸') || log.includes('ì‹œì‘')) {
                    color = '#93c5fd';
                }
                return `<div style="margin-bottom: 6px; color: ${color};">${log}</div>`;
            }).join('');
        }

        // ìƒì„¸ ë¡œê·¸ í† ê¸€
        function toggleVulnDetail(index) {
            const detailRow = document.getElementById(`vuln-detail-${index}`);
            if (detailRow.style.display === 'none') {
                // ë‹¤ë¥¸ ëª¨ë“  ë¡œê·¸ ë‹«ê¸°
                document.querySelectorAll('[id^="vuln-detail-"]').forEach(row => {
                    row.style.display = 'none';
                });
                // í˜„ì¬ ë¡œê·¸ ì—´ê¸°
                detailRow.style.display = 'table-row';
            } else {
                // í˜„ì¬ ë¡œê·¸ ë‹«ê¸°
                detailRow.style.display = 'none';
            }
        }

        // Show Vulnerability Detail Logs (êµ¬ë²„ì „ - ì‚­ì œ)
        function showVulnDetail(code) {
            // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        }

        // Close Vulnerability Detail (êµ¬ë²„ì „ - ì‚­ì œ)
        function closeVulnDetail() {
            // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        }

        // Close Detail Modal
        function closeDetailModal() {
            // ì—´ë ¤ìˆëŠ” ë¡œê·¸ íŒ¨ë„ ëª¨ë‘ ë‹«ê¸°
            document.querySelectorAll('[id^="vuln-detail-"]').forEach(row => {
                row.style.display = 'none';
            });
            document.getElementById('detailModal').classList.remove('active');
            currentTargetIP = null;
        }

        // Fix Vulnerability in Modal
        function fixVulnerabilityInModal(code) {
            const server = targetServers.find(s => s.ip === currentTargetIP);
            if (!server) return;
            
            addLog(`${server.ip}: ${code} ì¡°ì¹˜ ì‹œì‘`, 'info');
            showProgress('ğŸ”§', 'ì¡°ì¹˜ ì§„í–‰ ì¤‘', 'ì·¨ì•½ì ì„ í•´ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                const vuln = server.vulnerabilities.find(v => v.code === code);
                if (vuln) {
                    vuln.status = 'fixed';
                    // ì¡°ì¹˜ í›„ ë¡œê·¸ ì—…ë°ì´íŠ¸
                    vuln.current_value = vuln.expected_value;
                    const timestamp = new Date().toISOString().slice(0, 19).replace('T', ' ');
                    vuln.details.push(`[${timestamp}] ì¡°ì¹˜ ì™„ë£Œ: ì„¤ì • ë³€ê²½ ì ìš©ë¨`);
                    vuln.details.push(`[${timestamp}] ìµœì¢… ìƒíƒœ: ${vuln.expected_value}`);
                }
                
                server.vulnCount = server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                
                renderModalTable();
                renderTargetTable();
                updateStats();
                closeProgress();
                
                addLog(`${server.ip}: ${code} ì¡°ì¹˜ ì™„ë£Œ`, 'success');
            }, 2000);
        }

        // Fix All Vulnerabilities in Modal
        function fixAllVulnerabilitiesInModal() {
            const server = targetServers.find(s => s.ip === currentTargetIP);
            if (!server) return;
            
            const vulnCount = server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
            
            if (vulnCount === 0) {
                alert('ì¡°ì¹˜í•  ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            addLog(`${server.ip}: ì „ì²´ ì¡°ì¹˜ ì‹œì‘`, 'info');
            showProgress('ğŸ”§', 'ì¼ê´„ ì¡°ì¹˜ ì¤‘', 'ëª¨ë“  ì·¨ì•½ì ì„ í•´ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                const timestamp = new Date().toISOString().slice(0, 19).replace('T', ' ');
                server.vulnerabilities.forEach(v => {
                    if (v.status === 'vulnerable') {
                        v.status = 'fixed';
                        // ì¡°ì¹˜ í›„ ë¡œê·¸ ì—…ë°ì´íŠ¸
                        v.current_value = v.expected_value;
                        v.details.push(`[${timestamp}] ì¡°ì¹˜ ì™„ë£Œ: ì„¤ì • ë³€ê²½ ì ìš©ë¨`);
                        v.details.push(`[${timestamp}] ìµœì¢… ìƒíƒœ: ${v.expected_value}`);
                    }
                });
                
                server.vulnCount = 0;
                server.hasRegression = false;
                
                renderModalTable();
                renderTargetTable();
                updateStats();
                closeProgress();
                
                addLog(`${server.ip}: ì „ì²´ ì¡°ì¹˜ ì™„ë£Œ`, 'success');
            }, 3000);
        }

        // Generate Server Diagnosis Report (ê°œë³„ ì§„ë‹¨ ë³´ê³ ì„œ)
        function generateServerDiagnosisReport(ip) {
            const server = targetServers.find(s => s.ip === ip);
            if (!server || !server.diagnosed) {
                alert('ì§„ë‹¨ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog(`${server.ip} ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì¤‘`, 'info');
            showProgress('ğŸ“„', 'ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'ì„œë²„ ì·¨ì•½ì  ì§„ë‹¨ ê²°ê³¼ë¥¼ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤');

            setTimeout(() => {
                const vulnerableCount = server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                const fixedCount = server.vulnerabilities.filter(v => v.status === 'fixed').length;
                
                closeProgress();
                addLog(`${server.ip} ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ`, 'success');
                alert(`ğŸ“„ ${server.hostname} ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ\n\në°œê²¬ëœ ì·¨ì•½ì : ${vulnerableCount}ê°œ\nì¡°ì¹˜ëœ ì·¨ì•½ì : ${fixedCount}ê°œ\nì´ ì§„ë‹¨ í•­ëª©: ${server.vulnerabilities.length}ê°œ`);
            }, 2000);
        }

        // Generate Server Remediation Report (ê°œë³„ ì¡°ì¹˜ ë³´ê³ ì„œ)
        function generateServerRemediationReport(ip) {
            const server = targetServers.find(s => s.ip === ip);
            if (!server || !server.diagnosed) {
                alert('ì§„ë‹¨ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }

            const fixedCount = server.vulnerabilities.filter(v => v.status === 'fixed').length;
            if (fixedCount === 0) {
                alert('ì¡°ì¹˜ëœ ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤. ì¡°ì¹˜ë¥¼ ë¨¼ì € ìˆ˜í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog(`${server.ip} ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì¤‘`, 'info');
            showProgress('ğŸ“‹', 'ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'ì·¨ì•½ì  ì¡°ì¹˜ ë‚´ì—­ì„ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤');

            setTimeout(() => {
                const vulnerableCount = server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                
                closeProgress();
                addLog(`${server.ip} ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ`, 'success');
                alert(`ğŸ“‹ ${server.hostname} ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ\n\nì¡°ì¹˜ ì™„ë£Œ: ${fixedCount}ê°œ\në¯¸ì¡°ì¹˜: ${vulnerableCount}ê°œ\nì¡°ì¹˜ìœ¨: ${Math.round(fixedCount / server.vulnerabilities.length * 100)}%`);
            }, 2000);
        }

        // Generate Global Diagnosis Report (ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ)
        function generateGlobalDiagnosisReport() {
            const diagnosedServers = targetServers.filter(s => s.diagnosed);
            
            if (diagnosedServers.length === 0) {
                alert('ì§„ë‹¨ëœ ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            addLog('ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'info');
            showProgress('ğŸ“„', 'ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'ëª¨ë“  ì„œë²„ì˜ ì§„ë‹¨ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ê³  ìˆìŠµë‹ˆë‹¤');

            setTimeout(() => {
                let totalVulnerable = 0;
                let totalFixed = 0;
                
                diagnosedServers.forEach(server => {
                    totalVulnerable += server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                    totalFixed += server.vulnerabilities.filter(v => v.status === 'fixed').length;
                });
                
                const totalVulns = totalVulnerable + totalFixed;
                
                closeProgress();
                addLog('ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ', 'success');
                alert(`ğŸ“„ ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ\n\nëŒ€ìƒ ì„œë²„: ${diagnosedServers.length}ê°œ\në°œê²¬ëœ ì·¨ì•½ì : ${totalVulnerable}ê°œ\nì¡°ì¹˜ëœ ì·¨ì•½ì : ${totalFixed}ê°œ\nì´ ì·¨ì•½ì : ${totalVulns}ê°œ`);
            }, 2000);
        }

        // Generate Global Remediation Report (ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ)
        function generateGlobalRemediationReport() {
            const diagnosedServers = targetServers.filter(s => s.diagnosed);
            
            if (diagnosedServers.length === 0) {
                alert('ì§„ë‹¨ëœ ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            let totalFixed = 0;
            diagnosedServers.forEach(server => {
                totalFixed += server.vulnerabilities.filter(v => v.status === 'fixed').length;
            });

            if (totalFixed === 0) {
                alert('ì¡°ì¹˜ëœ ì·¨ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤. ì¡°ì¹˜ë¥¼ ë¨¼ì € ìˆ˜í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog('ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'info');
            showProgress('ğŸ“‹', 'ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì¤‘', 'ëª¨ë“  ì„œë²„ì˜ ì¡°ì¹˜ ë‚´ì—­ì„ ì¢…í•©í•˜ê³  ìˆìŠµë‹ˆë‹¤');

            setTimeout(() => {
                let totalVulnerable = 0;
                
                diagnosedServers.forEach(server => {
                    totalVulnerable += server.vulnerabilities.filter(v => v.status === 'vulnerable').length;
                });
                
                const totalVulns = totalVulnerable + totalFixed;
                const remediationRate = Math.round(totalFixed / totalVulns * 100);
                
                closeProgress();
                addLog('ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ', 'success');
                alert(`ğŸ“‹ ì „ì²´ ì¡°ì¹˜ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ\n\nëŒ€ìƒ ì„œë²„: ${diagnosedServers.length}ê°œ\nì¡°ì¹˜ ì™„ë£Œ: ${totalFixed}ê°œ\në¯¸ì¡°ì¹˜: ${totalVulnerable}ê°œ\nì¡°ì¹˜ìœ¨: ${remediationRate}%`);
            }, 2000);
        }

        // Update Snapshot Badge
        function updateSnapshotBadge() {
            const badge = document.getElementById('snapshotBadge');
            badge.innerHTML = `<span>ğŸ“¸</span><span>Snapshot #${currentSnapshot}</span>`;
        }

        // Progress Modal
        function showProgress(icon, title, desc) {
            document.getElementById('progressIcon').textContent = icon;
            document.getElementById('progressTitle').textContent = title;
            document.getElementById('progressDesc').textContent = desc;
            document.getElementById('progressModal').classList.add('active');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressPercent').textContent = progress;
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 100);
        }

        function closeProgress() {
            setTimeout(() => {
                document.getElementById('progressModal').classList.remove('active');
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('progressPercent').textContent = '0';
            }, 500);
        }

        // Initialize
        window.addEventListener('load', () => {
            addLog('AUTOISMS ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        });

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>
